# Notes:
#
#
---
apic:
  tenants:
    - name: BRKDCN-2959-DMZ
      description: Current network design - firewall provides default gateway

# Policies
      policies:
        ospf_interface_policies:
          - name: broadcast
            cost: unspecified
            passive_interface: false
            mtu_ignore: false
            advertise_subnet: false
            bfd: false
            hello_interval: 10
            dead_interval: 40
            network_type: bcast
            priority: 1
            lsa_retransmit_interval: 5
            lsa_transmit_delay: 1

# Filters
      filters:
        - name: 'icmp'
          entries:
            - name: 'icmp'
              protocol: icmp

        - name: 'src-any-dst-any'
          entries:
            - name: 'src-any-dst-any'
              ethertype: unspecified

# Contracts
      contracts:
        - name: permit-to-all-dmz-subnets
          description: allows traffic to all dmz subnets
          scope: context
          subjects:
            - name: permit-src-any-dst-any
              filters: 
                - filter: src-any-dst-any

# VRFs
      vrfs:
        - name: vrf-01
          description: configured with NAC
          alias: dmz-vrf

#L3out
      l3outs:
        - name: brkdcn-2959-dmz.vrf-01-ospf-to-fw
          description: configured with NAC
          alias: dmz-vrf
          vrf: vrf-01
          domain: BRKDCN-2959-DMZ.vrf-01
          ospf:
            area: 0.0.0.0
            area_type: regular

          node_profiles:
            - name: border-leafs
              nodes:
                - node_id: 1101
                  router_id: 101.1.0.7

                - node_id: 1102
                  router_id: 102.1.0.7

              interface_profiles:
                - name: vrf-01-ospf-to-fw         # this creates a single interface profile for both port channels
                  interfaces:
                    - node_id: 1101                       
                      mode: regular                       
                      floating_svi: true
                      vlan: 3000
                      mtu: 1500
                      paths:
                        - floating_ip: 10.237.99.75/29
                          vmware_vmm_domain: hx-dev-01-vds-01
                      ip: 10.237.99.73/29
                      ip_shared: 10.237.99.76/29

                    - node_id: 1102                     
                      mode: regular                       
                      floating_svi: true
                      vlan: 3000
                      mtu: 1500
                      paths:
                        - floating_ip: 10.237.99.75/29
                          vmware_vmm_domain: hx-dev-01-vds-01
                      ip: 10.237.99.74/29
                      ip_shared: 10.237.99.76/29
                  ospf:
                    policy: broadcast

              # interface_profiles:
              #   - name: hx-dev-01-fi-a-vlan-30
              #     interfaces:
              #       - node_id: 1101
              #         channel: hx-dev-01-fi-a
              #         vlan: 10
              #         svi: true
              #         ip: 10.237.99.73/29
              #         ip_shared: 10.237.99.75/29
              #         mtu: 1500
              #     ospf:
              #       policy: broadcast

              #   - name: hx-dev-01-fi-b-vlan-30
              #     interfaces:
              #       - node_id: 1102
              #         channel: hx-dev-01-fi-b
              #         vlan: 10
              #         svi: true
              #         ip: 10.237.99.74/29
              #         ip_shared: 10.237.99.75/29
              #         mtu: 1500
              #     ospf:
              #       policy: broadcast

          external_endpoint_groups:
            - name: all-dmz-subnets
              subnets:
                - prefix: 0.0.0.0/1
                  shared_security: true

                - prefix: 128.0.0.0/1
                  shared_security: true

              contracts:
                providers:
                  - permit-to-all-dmz-subnets

# Bridge Domains
      bridge_domains:
        - name: 172.16.10.0_24
          alias: dmz-subnet
          vrf: vrf-01

        - name: 172.16.11.0_24
          alias: dmz-subnet
          vrf: vrf-01

        - name: 172.16.12.0_24
          alias: dmz-subnet
          vrf: vrf-01

# Application profiles
      application_profiles:
        - name: 'network-segments'
          description: EPGs provide the VLAN backing for application workloads
          endpoint_groups:      
            - name: '172.16.10.0_24'
              # alias:
              bridge_domain: '172.16.10.0_24'
              vmware_vmm_domains:
                - name: hx-dev-01-vds-01
                  deployment_immediacy: immediate
                  resolution_immediacy: immediate

            - name: '172.16.11.0_24'
              # alias:
              bridge_domain: '172.16.11.0_24'
              vmware_vmm_domains:
                - name: hx-dev-01-vds-01
                  deployment_immediacy: immediate
                  resolution_immediacy: immediate

            - name: '172.16.12.0_24'
              # alias:
              bridge_domain: '172.16.12.0_24'
              vmware_vmm_domains:
                - name: hx-dev-01-vds-01
                  deployment_immediacy: immediate
                  resolution_immediacy: immediate