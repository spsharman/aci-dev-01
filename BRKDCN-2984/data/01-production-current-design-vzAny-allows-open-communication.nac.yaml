# Notes:
#
# Base design, L3out with BGP to core, 3x bridge domains, 3x EPGs
#
---
apic:
  tenants:
    - name: BRKDCN-2984
      description: Current network design - L3out consumer to vzAny

# Policies

# Filters
      filters:
        - name: 'icmp'
          entries:
            - name: 'icmp'
              protocol: icmp

        - name: 'src-any-dst-any'
          entries:
            - name: 'src-any-dst-any'
              ethertype: unspecified

# Contracts
      contracts:
        - name: intra-vrf
          description: vzAny is contract Consumer and Provider
          scope: context
          subjects:
            - name: permit-src-any-dst-any
              filters: 
                - filter: src-any-dst-any

# VRFs
      vrfs:
        - name: vrf-01
          description: configured with NAC
          alias: production-vrf
          contracts:
            providers:
              - intra-vrf
            consumers:
              - intra-vrf

# L3out BGP
      l3outs:
        - name: vrf-01-bgp-to-core
          description: configured with NAC
          vrf: vrf-01
          domain: BRKDCN-2984.vrf-01

# Nodes
          node_profiles:
            - name: border-leafs-pod-1
              nodes:
                - node_id: 1101
                  pod_id: 1
                  router_id: 101.1.0.8
                  router_id_as_loopback: true

                - node_id: 1102
                  pod_id: 1
                  router_id: 102.1.0.8
                  router_id_as_loopback: true

# Interfaces
              interface_profiles:
                - name: leaf-1101-eth7.13
                  description: core-01 eth1/7.13
                  interfaces:
                    - node_id: 1101
                      port: 7
                      vlan: 12
                      svi: false
                      ip: 10.237.97.56/31
                      mac: "00:11:01:07:12:FF"
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.57/32
                          description: core-01 eth1/7.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend

                - name: leaf-1101-eth8.13
                  description: core-02 eth1/8.13
                  interfaces:
                    - node_id: 1101
                      port: 8
                      vlan: 12
                      svi: false
                      ip: 10.237.97.58/31
                      mac: "00:11:01:08:12:FF"
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.59/32
                          description: core-02 eth1/8.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend

                - name: leaf-1102-eth7.13
                  description: core-02 eth1/7.13
                  interfaces:
                    - node_id: 1102
                      port: 7
                      vlan: 12
                      svi: false
                      ip: 10.237.97.60/31
                      mac: "00:11:02:07:12:FF"
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.61/32
                          description: core-02 eth1/7.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend

                - name: leaf-1102-eth8.13
                  description: core-01 eth1/8.13
                  interfaces:
                    - node_id: 1102
                      port: 8
                      vlan: 12
                      svi: false
                      ip: 10.237.97.62/31
                      mac: "00:11:01:08:12:FF"
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.63/32
                          description: core-01 eth1/8.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend

            - name: border-leafs-pod-2
              nodes:
                - node_id: 2101
                  pod_id: 2
                  router_id: 101.2.0.8
                  router_id_as_loopback: true

                - node_id: 2102
                  pod_id: 2
                  router_id: 102.2.0.8
                  router_id_as_loopback: true

              interface_profiles:
                - name: leaf-2101-eth7.13
                  description: core-03 eth1/7.13
                  interfaces:
                    - node_id: 2101
                      pod_id: 2
                      port: 7
                      vlan: 12
                      svi: false
                      ip: 10.237.97.64/31
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.65/32
                          description: core-03 eth1/7.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend
                          # peer_prefix_policy: cilium-cni

                - name: leaf-2101-eth8.13
                  description: core-04 eth1/8.13
                  interfaces:
                    - node_id: 2101
                      pod_id: 2
                      port: 8
                      vlan: 12
                      svi: false
                      ip: 10.237.97.66/31
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.67/32
                          description: core-04 eth1/8.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend
                          # peer_prefix_policy: cilium-cni

                - name: leaf-2102-eth7.13
                  description: core-04 eth1/7.13
                  interfaces:
                    - node_id: 2102
                      pod_id: 2
                      port: 7
                      vlan: 12
                      svi: false
                      ip: 10.237.97.68/31
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.69/32
                          description: core-04 eth1/7.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend
                          # peer_prefix_policy: cilium-cni

                - name: leaf-2102-eth8.13
                  description: core-02 eth1/8.13
                  interfaces:
                    - node_id: 2102
                      pod_id: 2
                      port: 8
                      vlan: 12
                      svi: false
                      ip: 10.237.97.70/31
                      mtu: inherit
                      bgp_peers:
                        - ip: 10.237.97.71/32
                          description: core-03 eth1/8.13
                          remote_as: 64800  
                          local_as: 64803
                          allow_self_as: false
                          as_override: true
                          disable_peer_as_check: true
                          next_hop_self: false
                          send_community: false
                          send_ext_community: false
                          allowed_self_as_count: 3
                          bfd: false
                          disable_connected_check: false
                          ttl: 2
                          remove_all_private_as: false
                          remove_private_as: false
                          replace_private_as_with_local_as: false
                          unicast_address_family: true
                          multicast_address_family: false
                          admin_state: true
                          as_propagate: no-prepend

# extEPGs
          external_endpoint_groups:
            - name: all-ext-subnets
              subnets:
                - prefix: 0.0.0.0/1
                  import_security: true

                - prefix: 128.0.0.0/1
                  import_security: true

            - name: lab-desktops-subnets
              subnets:
                - prefix: 10.237.97.160/28
                  name: lab-desktops
                  import_security: true

# Bridge Domains
      bridge_domains:
        - name: 192.168.20.0_24
          alias: production-subnet
          unknown_unicast: proxy
          vrf: vrf-01
          l3outs:
            - vrf-01-bgp-to-core
          subnets:
            - ip: 192.168.20.1/24
              public: true # not required when using ESG route leaking under the VRF
          dhcp_labels:
            - dhcp_relay_policy: dhcp.uktme.cisco.com

        - name: 192.168.21.0_24
          alias: production-subnet
          unknown_unicast: proxy
          vrf: vrf-01
          l3outs:
            - vrf-01-bgp-to-core
          subnets:
            - ip: 192.168.21.1/24
              public: true # not required when using ESG route leaking under the VRF
          dhcp_labels:
            - dhcp_relay_policy: dhcp.uktme.cisco.com

        - name: 192.168.22.0_24
          alias: production-subnet
          unknown_unicast: proxy
          vrf: vrf-01
          l3outs:
            - vrf-01-bgp-to-core
          subnets:
            - ip: 192.168.22.1/24
              public: true # not required when using ESG route leaking under the VRF
          dhcp_labels:
            - dhcp_relay_policy: dhcp.uktme.cisco.com

# Application profiles
      application_profiles:
        - name: 'network-segments'
          description: EPGs provide the VLAN backing for application workloads
          endpoint_groups:      
            - name: '192.168.20.0_24'
              # alias:
              bridge_domain: '192.168.20.0_24'
              vmware_vmm_domains:
                - name: hx-dev-01-vds-01
                  deployment_immediacy: immediate
                  resolution_immediacy: immediate

            - name: '192.168.21.0_24'
              # alias:
              bridge_domain: '192.168.21.0_24'
              vmware_vmm_domains:
                - name: hx-dev-01-vds-01
                  deployment_immediacy: immediate
                  resolution_immediacy: immediate

            - name: '192.168.22.0_24'
              # alias:
              bridge_domain: '192.168.22.0_24'
              vmware_vmm_domains:
                - name: hx-dev-01-vds-01
                  deployment_immediacy: immediate
                  resolution_immediacy: immediate